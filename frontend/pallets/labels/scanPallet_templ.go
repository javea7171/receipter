// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package labels

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import sharedhtml "receipter/frontend/shared/html"

func ScanPalletPage(prefill string, showAdminLinks bool) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<!doctype html><html data-theme=\"light\"><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, viewport-fit=cover\"><title>Scan Pallet</title><link rel=\"stylesheet\" href=\"/assets/app.css\"></head><body>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = sharedhtml.TopBarWithRole("Scan Pallet", showAdminLinks).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "<main class=\"container-shell flex min-h-[calc(100dvh-8rem)] items-center justify-center\"><section class=\"page-card w-full max-w-md\"><div class=\"page-card-body space-y-6\"><div class=\"text-center\"><div class=\"inline-flex items-center justify-center size-16 rounded-full bg-primary/10 mb-3\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"size-8 text-primary\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z\"></path> <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z\"></path></svg></div><h1 class=\"text-xl font-bold\">Scan Pallet</h1><p class=\"text-sm text-base-content/60 mt-1\">Scan or enter pallet barcode</p></div><form id=\"scan-form\" class=\"space-y-4\"><fieldset class=\"fieldset\"><legend class=\"fieldset-legend text-base font-medium\">Pallet barcode</legend><div class=\"join w-full\"><input type=\"text\" class=\"input input-bordered input-lg join-item w-full text-center text-2xl tracking-widest font-mono\" id=\"pallet_barcode\" placeholder=\"P00000001\" autofocus autocomplete=\"off\" value=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var2 string
		templ_7745c5c3_Var2, templ_7745c5c3_Err = templ.JoinStringErrs(prefill)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `frontend/pallets/labels/scanPallet.templ`, Line: 33, Col: 218}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var2))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "\"> <button class=\"btn btn-primary btn-lg join-item\" type=\"button\" onclick=\"openPalletScanModal('pallet_barcode')\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\" class=\"size-6\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z\"></path> <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z\"></path></svg> Scan</button></div><p class=\"fieldset-label text-base-content/50 text-sm\">Example: P00000001</p></fieldset><button class=\"btn btn-primary btn-lg w-full text-lg\" type=\"submit\">Open Receipt Screen</button></form></div></section></main>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = sharedhtml.DockWithRole(sharedhtml.NavScan, showAdminLinks).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "<dialog id=\"scan-modal\" class=\"modal\"><div class=\"modal-box max-w-3xl\"><h3 class=\"text-lg font-semibold\">Scan Pallet Barcode</h3><div id=\"scan-reader\" class=\"mt-3 h-72 w-full overflow-hidden rounded-lg bg-neutral text-neutral-content\"></div><p id=\"scan-status\" class=\"mt-3 text-sm opacity-70\">Camera idle</p><div class=\"modal-action\"><button class=\"btn btn-lg w-full\" type=\"button\" onclick=\"closePalletScanModal()\">Close</button></div></div></dialog><script>\n\t\t\t\tlet palletScanTargetInput = null;\n\t\t\t\tlet palletScannerRunning = false;\n\t\t\t\tlet palletDetectedHandler = null;\n\n\t\t\t\tfunction openReceiptByPalletCode(raw) {\n\t\t\t\t  if (!raw) return;\n\t\t\t\t  const digits = raw.replace(/[^0-9]/g, '');\n\t\t\t\t  if (!digits) {\n\t\t\t\t    alert('Invalid pallet code');\n\t\t\t\t    return false;\n\t\t\t\t  }\n\t\t\t\t  const id = parseInt(digits, 10);\n\t\t\t\t  if (!id || id < 1) {\n\t\t\t\t    alert('Invalid pallet id');\n\t\t\t\t    return false;\n\t\t\t\t  }\n\t\t\t\t  window.location.href = '/tasker/pallets/' + id + '/receipt';\n\t\t\t\t  return true;\n\t\t\t\t}\n\n\t\t\t\tfunction setPalletScanStatus(msg) {\n\t\t\t\t  const el = document.getElementById(\"scan-status\");\n\t\t\t\t  if (el) el.textContent = msg;\n\t\t\t\t}\n\n\t\t\t\tfunction loadQuaggaScript() {\n\t\t\t\t  if (window.Quagga) return Promise.resolve();\n\t\t\t\t  return new Promise((resolve, reject) => {\n\t\t\t\t    const s = document.createElement(\"script\");\n\t\t\t\t    s.src = \"https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.4/dist/quagga.min.js\";\n\t\t\t\t    s.onload = resolve;\n\t\t\t\t    s.onerror = reject;\n\t\t\t\t    document.head.appendChild(s);\n\t\t\t\t  });\n\t\t\t\t}\n\n\t\t\t\tasync function openPalletScanModal(targetInputID) {\n\t\t\t\t  palletScanTargetInput = document.getElementById(targetInputID);\n\t\t\t\t  const modal = document.getElementById(\"scan-modal\");\n\t\t\t\t  if (!modal) return;\n\t\t\t\t  modal.showModal();\n\t\t\t\t  setPalletScanStatus(\"Starting camera...\");\n\t\t\t\t  try {\n\t\t\t\t    await startPalletScanner();\n\t\t\t\t  } catch (err) {\n\t\t\t\t    setPalletScanStatus(\"Camera failed: \" + (err && err.message ? err.message : err));\n\t\t\t\t  }\n\t\t\t\t}\n\n\t\t\t\tfunction closePalletScanModal() {\n\t\t\t\t  stopPalletScanner();\n\t\t\t\t  const modal = document.getElementById(\"scan-modal\");\n\t\t\t\t  if (modal && modal.open) modal.close();\n\t\t\t\t  setPalletScanStatus(\"Camera idle\");\n\t\t\t\t}\n\n\t\t\t\tasync function startPalletScanner() {\n\t\t\t\t  if (palletScannerRunning) return;\n\t\t\t\t  await loadQuaggaScript();\n\t\t\t\t  const target = document.getElementById(\"scan-reader\");\n\t\t\t\t  if (!target) throw new Error(\"scan target missing\");\n\n\t\t\t\t  await new Promise((resolve, reject) => {\n\t\t\t\t    window.Quagga.init({\n\t\t\t\t      inputStream: {\n\t\t\t\t        type: \"LiveStream\",\n\t\t\t\t        target: target,\n\t\t\t\t        constraints: {\n\t\t\t\t          facingMode: { ideal: \"environment\" }\n\t\t\t\t        }\n\t\t\t\t      },\n\t\t\t\t      decoder: {\n\t\t\t\t        readers: [\"code_128_reader\", \"ean_reader\", \"ean_8_reader\", \"upc_reader\", \"upc_e_reader\"]\n\t\t\t\t      },\n\t\t\t\t      locate: true\n\t\t\t\t    }, (err) => {\n\t\t\t\t      if (err) return reject(err);\n\t\t\t\t      return resolve();\n\t\t\t\t    });\n\t\t\t\t  });\n\n\t\t\t\t  if (palletDetectedHandler) {\n\t\t\t\t    window.Quagga.offDetected(palletDetectedHandler);\n\t\t\t\t  }\n\n\t\t\t\t  palletDetectedHandler = function(result) {\n\t\t\t\t    const code = result && result.codeResult && result.codeResult.code;\n\t\t\t\t    if (!code || !palletScanTargetInput) return;\n\t\t\t\t    palletScanTargetInput.value = code;\n\t\t\t\t    const opened = openReceiptByPalletCode(code);\n\t\t\t\t    if (!opened) {\n\t\t\t\t      setPalletScanStatus(\"Scanned value is not a valid pallet code\");\n\t\t\t\t      return;\n\t\t\t\t    }\n\t\t\t\t    closePalletScanModal();\n\t\t\t\t  };\n\t\t\t\t  window.Quagga.onDetected(palletDetectedHandler);\n\t\t\t\t  window.Quagga.start();\n\t\t\t\t  palletScannerRunning = true;\n\t\t\t\t  setPalletScanStatus(\"Point the camera at a barcode\");\n\t\t\t\t}\n\n\t\t\t\tfunction stopPalletScanner() {\n\t\t\t\t  if (!window.Quagga || !palletScannerRunning) return;\n\t\t\t\t  if (palletDetectedHandler) {\n\t\t\t\t    window.Quagga.offDetected(palletDetectedHandler);\n\t\t\t\t  }\n\t\t\t\t  window.Quagga.stop();\n\t\t\t\t  palletScannerRunning = false;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById('scan-form').addEventListener('submit', function(e) {\n\t\t\t\t  e.preventDefault();\n\t\t\t\t  const raw = document.getElementById('pallet_barcode').value.trim();\n\t\t\t\t  openReceiptByPalletCode(raw);\n\t\t\t\t});\n\n\t\t\t\tconst scanModal = document.getElementById('scan-modal');\n\t\t\t\tif (scanModal) {\n\t\t\t\t  scanModal.addEventListener('close', function() {\n\t\t\t\t    stopPalletScanner();\n\t\t\t\t  });\n\t\t\t\t}\n\t\t\t</script><script>\n\t\t\t\tdocument.addEventListener('keydown', function(event) {\n\t\t\t\t  if (event.key === 'Enter' && document.activeElement && document.activeElement.id === 'pallet_barcode') {\n\t\t\t\t    event.preventDefault();\n\t\t\t\t    openReceiptByPalletCode(document.getElementById('pallet_barcode').value.trim());\n\t\t\t\t  }\n\t\t\t\t});\n\t\t\t</script></body></html>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
